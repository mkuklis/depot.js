// depot.js v0.1.4 | (c) 2013 Michal Kuklis | Licensed under The MIT License
(function(e,g,d){"object"==typeof exports?module.exports=d():"function"==typeof define&&define.amd?define(d):g[e]=d()})("depot",this,function(){function e(b){return b&&JSON.parse(b)}function g(b,a){var c,f;if("function"==typeof b)c=b(a);else for(f in c=!0,b)c&=b[f]===a[f];return c}function d(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function h(b,a){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}var j={save:function(b){var a;b[this.idAttribute]||(b[this.idAttribute]=
d()+d()+"-"+d()+"-"+d()+"-"+d()+"-"+d()+d()+d());a=b[this.idAttribute];0>this.ids.indexOf(a)&&(this.ids.push(a),localStorage.setItem(this.name,this.ids.join(",")));localStorage.setItem(this.name+"-"+a,JSON.stringify(b));return b},update:function(b,a){"undefined"==typeof a&&(a=b,b=a[this.idAttribute]);var c=this.get(b);c&&(c=h(c,a),this.save(c));return c},updateAll:function(b){var a=this.all();a.forEach(function(a){a=h(a,b);this.save(a)},this);return a},find:function(b){var a,c,f=this.name;return!b?
this.all():this.ids.reduce(function(d,h){c=e(localStorage.getItem(f+"-"+h));(a=g(b,c))&&d.push(c);return d},[])},get:function(b){return e(localStorage.getItem(this.name+"-"+b))},all:function(){var b,a=this.name;return this.ids.reduce(function(c,d){(b=localStorage.getItem(a+"-"+d))&&c.push(e(b));return c},[])},destroy:function(b){var a;a=b[this.idAttribute]?b[this.idAttribute]:b;var c=this.name+"-"+a;b=e(localStorage.getItem(c));localStorage.removeItem(c);a=this.ids.indexOf(a);-1!=a&&this.ids.splice(a,
1);localStorage.setItem(this.name,this.ids.join(","));return b},destroyAll:function(b){for(var a,c,d=this.ids.length-1;0<=d;d--)if(a=this.ids[d],a=this.name+"-"+a,b){if(c=e(localStorage.getItem(a)),c=g(b,c))localStorage.removeItem(a),this.ids.splice(d,1)}else localStorage.removeItem(a);b?localStorage.setItem(this.name,this.ids.join(",")):(localStorage.removeItem(this.name),this.ids=[])},size:function(){return this.ids.length}};return function(b,a){var c,d;if(!localStorage)throw Error("localStorage not found");
d=(c=localStorage.getItem(b))&&c.split(",")||[];a=a||{};return Object.create(j,{name:{value:b},store:{value:c},ids:{value:d,writable:!0},idAttribute:{value:a.idAttribute||"_id"}})}});
